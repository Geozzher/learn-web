<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>promise</title>
</head>

<body>
    <script>

        const PENDING = 'pending'
        const FULFILLED = 'fulfilled'
        const REJECTED = 'rejected'
        class Promise {
            constructor(excutor) {
                this.status = PENDING

                this.value = undefined
                this.reason = undefined

                this.onfulfilledCallBack = []
                this.onrejectedCallBack = []

                let resolve = (value) => {
                    if (this.status === PENDING) {
                        this.value = value
                        this.status = FULFILLED

                        this.onfulfilledCallBack.forEach(fn => fn())
                    }
                }

                let reject = (reason) => {
                    if (this.status === REJECTED) {
                        this.reason = reason
                        this.status = REJECTED

                        this.onrejectedCallBack.forEach(fn => fn())
                    }
                }

                try {
                    excutor(resolve, reject)
                } catch (e) {
                    reject(e)
                }

            }

            then(onfulfilled, onrejected) {
                if (this.status === FULFILLED) {
                    onfulfilled(this.value)
                }

                if (this.status === REJECTED) {
                    onrejected(this.reason)
                }


                if (this.status === PENDING) {

                    this.onfulfilledCallBack.push(() => {
                        onfulfilled(this.value)
                    })

                    this.onrejectedCallBack.push(() => {
                        onrejected(this.reason)
                    })
                }
            }

            static all(promises) {
                return new Promise((resolve, reject) => {
                    const res = []
                    let num = 0
                    promises.forEach(promise => {
                        promise.then(value => {
                            res.push(value)
                            num++
                            if(num === promises.length) {
                                resolve(res)
                            }
                        }, reason => {
                            reject(reason)
                        })
                    }).catch(e){
                        reject(e)
                    }
                })
            }
        }

        const p = new Promise((resolve, reject) => {
            setTimeout(() => {
                resolve('14441')
            }, 1000);
        })

        p.then((value) => {
            console.log(value);
        })
    </script>
</body>

</html>